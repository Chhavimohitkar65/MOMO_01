/*! For license information please see extension.js.LICENSE.txt */
(()=>{"use strict";var e={20:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parsePatch=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.split(/\r\n|[\n\v\f\r\x85]/),r=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],i=[],s=0;function o(){var e={};for(i.push(e);s<n.length;){var r=n[s];if(/^(\-\-\-|\+\+\+|@@)\s/.test(r))break;var o=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(r);o&&(e.index=o[1]),s++}for(a(e),a(e),e.hunks=[];s<n.length;){var l=n[s];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(l))break;if(/^@@/.test(l))e.hunks.push(c());else{if(l&&t.strict)throw new Error("Unknown line "+(s+1)+" "+JSON.stringify(l));s++}}}function a(e){var t=/^(---|\+\+\+)\s+(.*)$/.exec(n[s]);if(t){var r="---"===t[1]?"old":"new",i=t[2].split("\t",2),o=i[0].replace(/\\\\/g,"\\");/^".*"$/.test(o)&&(o=o.substr(1,o.length-2)),e[r+"FileName"]=o,e[r+"Header"]=(i[1]||"").trim(),s++}}function c(){var e=s,i=n[s++].split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),o={oldStart:+i[1],oldLines:void 0===i[2]?1:+i[2],newStart:+i[3],newLines:void 0===i[4]?1:+i[4],lines:[],linedelimiters:[]};0===o.oldLines&&(o.oldStart+=1),0===o.newLines&&(o.newStart+=1);for(var a=0,c=0;s<n.length&&!(0===n[s].indexOf("--- ")&&s+2<n.length&&0===n[s+1].indexOf("+++ ")&&0===n[s+2].indexOf("@@"));s++){var l=0==n[s].length&&s!=n.length-1?" ":n[s][0];if("+"!==l&&"-"!==l&&" "!==l&&"\\"!==l)break;o.lines.push(n[s]),o.linedelimiters.push(r[s]||"\n"),"+"===l?a++:"-"===l?c++:" "===l&&(a++,c++)}if(a||1!==o.newLines||(o.newLines=0),c||1!==o.oldLines||(o.oldLines=0),t.strict){if(a!==o.newLines)throw new Error("Added line count did not match for hunk at line "+(e+1));if(c!==o.oldLines)throw new Error("Removed line count did not match for hunk at line "+(e+1))}return o}for(;s<n.length;)o();return i}},23:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.GeminiService=void 0;const a=o(n(398)),c=n(445);t.GeminiService=class{constructor(e){this.genAI=null,this.model=null,this.apiKey="",this.modelName="gemini-2.0-flash",this.context=e,this.initialize(),a.workspace.onDidChangeConfiguration((e=>{e.affectsConfiguration("momo.apiKey")&&this.initialize()}))}initialize(){const e=a.workspace.getConfiguration("momo");if(this.apiKey=e.get("apiKey"),this.apiKey)try{this.genAI=new c.GoogleGenerativeAI(this.apiKey),this.model=this.genAI.getGenerativeModel({model:this.modelName}),console.log("Initialized Gemini 2.0 Flash model")}catch(e){console.error("Failed to initialize Gemini API:",e),a.window.showErrorMessage("Failed to initialize Gemini API. Please check your API key.")}else a.window.showWarningMessage("Gemini API key not set. Please set it in the extension settings.")}getModelConfig(){return{temperature:.3,topK:20,topP:.8,maxOutputTokens:4096}}async generateResponse(e,t){if(!this.model)throw new Error("Gemini model not initialized. Please check your API key.");try{const n=[];t&&n.push({role:"system",content:t}),n.push(...e);const r=n.map((e=>({role:"assistant"===e.role?"model":e.role,parts:[{text:e.content}]}))),i=this.model.startChat({generationConfig:this.getModelConfig(),history:r.slice(0,-1)}),s=r[r.length-1];return(await i.sendMessage(s.parts[0].text)).response.text()}catch(e){throw console.error("Error generating response:",e),new Error(`Failed to generate response: ${e}`)}}async generateWithToolCalling(e,t,n){if(!this.model)throw new Error("Gemini model not initialized. Please check your API key.");try{const r=[];n&&r.push({role:"system",content:n}),r.push(...e);const i=r.map((e=>({role:"assistant"===e.role?"model":e.role,parts:[{text:e.content}]}))),s=this.model.startChat({generationConfig:{...this.getModelConfig(),temperature:.2},tools:t,history:i.slice(0,-1)}),o=i[i.length-1];return(await s.sendMessage(o.parts[0].text)).response}catch(e){throw console.error("Error in tool calling:",e),new Error(`Failed in tool calling: ${e}`)}}}},29:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ChromeDevTools=void 0;const a=o(n(398));t.ChromeDevTools=class{constructor(){this.client=null,this.outputChannel=a.window.createOutputChannel("Chrome DevTools")}async connectToDevTools(){try{return!0}catch(e){return this.outputChannel.appendLine(`Error connecting to DevTools: ${e}`),!1}}async analyzeUI(e){return{elements:[],suggestions:[]}}async captureScreenshot(e){return""}async evaluateAccessibility(e){return[]}async monitorNetworkRequests(){}async injectUITest(e){}dispose(){this.outputChannel.dispose()}}},37:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RunAgent=void 0,t.RunAgent=class{constructor(){this.id="run-agent",this.name="Run Agent",this.description="Executes code and commands in the workspace",this.commandPrefix="@run"}canHandle(e){return e.startsWith(this.commandPrefix)}async execute(e){try{const{prompt:t}=e;if(!t)return{success:!1,message:"No command provided"};const n=t.substring(this.commandPrefix.length).trim();return{success:!0,message:`Would run command: ${n}`,content:n}}catch(e){return{success:!1,message:`Error executing command: ${e instanceof Error?e.message:String(e)}`}}}}},40:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentationAgent=void 0;const a=o(n(928)),c=o(n(943));t.DocumentationAgent=class{constructor(){this.id="doc-agent",this.name="Documentation Agent",this.description="Generates documentation for files and folders",this.commandPrefix="@doc"}canHandle(e){return e.startsWith(this.commandPrefix)}async execute(e){try{const{filePath:t,prompt:n,fileService:r,geminiService:i}=e;if(!t)return{success:!1,message:"Please specify a file or folder path"};const s=t.startsWith("@doc")?t.substring(4).trim():t,o=this.getDocumentationFilePath(s);let a;try{const e=await r.readFile(s);return a=await this.generateDocumentation(s,e,n||"",i),await r.writeFile(o,a),{success:!0,message:`Documentation created at: ${o}`,content:a}}catch(e){return{success:!1,message:`Error processing file ${s}: ${e instanceof Error?e.message:String(e)}`}}}catch(e){return{success:!1,message:`Error in DocumentationAgent: ${e instanceof Error?e.message:String(e)}`}}}getDocumentationFilePath(e){const t=a.dirname(e),n=a.basename(e,a.extname(e));return a.join(t,`${n}_documentation.txt`)}async generateDocumentation(e,t,n,r){const i=a.extname(e),s=`\nAnalyze and document the following ${i} file:\n${a.basename(e)}\n\nCODE:\n\`\`\`${i}\n${t}\n\`\`\`\n\nGenerate detailed documentation including:\n\nFILE OVERVIEW\n-------------\n- Purpose and main functionality\n- Key features and responsibilities\n\nCOMPONENTS BREAKDOWN\n------------------\n- List of functions/methods\n- Classes and interfaces\n- Important variables and constants\n\nDEPENDENCIES\n-----------\n- External dependencies\n- Internal module dependencies\n\nUSAGE EXAMPLES\n-------------\n- Basic usage examples\n- Common patterns\n\nTECHNICAL DETAILS\n---------------\n- Important implementation details\n- Architecture decisions\n- Performance considerations\n\nAdditional requirements: ${n}\n\nFormat the response as a plain text document with clear sections and proper spacing.`,o=await r.generateResponse([{role:"user",content:s}]);return`DOCUMENTATION GENERATED ON: ${(new Date).toISOString()}\n========================================\n\n${o}`}createChangeLogEntry(e,t,n,r){return`\n=================================================================\nDate: ${e}\nTarget: ${t}\nAction: ${n}\nRequest: ${r||"No specific requirements"}\n=================================================================\n`}getChangeLogPath(e){const t=a.dirname(e);return a.join(t,"documentation_changes.txt")}async updateChangeLog(e,t,n){let r="";try{r=await n.readFile(e)}catch(e){}const i=t+r;await n.writeFile(e,i)}async generateFileDocumentation(e,t,n,r){const i=a.extname(e),s=`\nGenerate comprehensive documentation for this ${i} file.\nFile: ${a.basename(e)}\n\nContent:\n\`\`\`${i}\n${t}\n\`\`\`\n\nAdditional requirements: ${n}\n\nPlease provide markdown documentation that includes:\n1. Overview of the file's purpose\n2. Main components/functions and their purposes\n3. Important types/interfaces/classes\n4. Usage examples where applicable\n5. Dependencies and requirements\n6. Any important notes or caveats\n\nFormat the response as a proper markdown document.`;return await r.generateResponse([{role:"user",content:s}])}async generateFolderDocumentation(e,t,n){const r=await this.getFolderStructure(e),i=await this.getFileOverviews(e,t,n),s=`\nGenerate comprehensive documentation for this project folder.\nFolder: ${a.basename(e)}\n\nFolder structure:\n\`\`\`\n${r}\n\`\`\`\n\nFile overviews:\n${i}\n\nPlease provide a markdown document that includes:\n1. Project overview\n2. Folder structure explanation\n3. Main components and their purposes\n4. Setup and installation instructions\n5. Usage examples\n6. Dependencies\n7. Contributing guidelines\n8. License information (if available)\n\nFormat the response as a proper markdown document.`;return await n.generateResponse([{role:"user",content:s}])}async getFolderStructure(e,t=""){let n="";const r=await c.readdir(e);for(const i of r){if(this.shouldIgnore(i))continue;const r=a.join(e,i);(await c.stat(r)).isDirectory()?(n+=`${t}${i}/\n`,n+=await this.getFolderStructure(r,t+"  ")):n+=`${t}${i}\n`}return n}async getFileOverviews(e,t,n){const r=await this.findImportantFiles(e);let i="";for(const s of r)try{const r=await t.readFile(s),o=await n.generateResponse([{role:"user",content:`Provide a 2-3 sentence overview of this file's purpose:\n\`\`\`\n${r}\n\`\`\``}]);i+=`\n${a.relative(e,s)}:\n${o}\n`}catch(e){console.error(`Error processing ${s}:`,e)}return i}async findImportantFiles(e){const t=[],n=this;return await async function e(r){const i=await c.readdir(r);for(const s of i){if(s.startsWith("."))continue;const i=a.join(r,s);(await c.stat(i)).isDirectory()?await e(i):n.isImportantFile(s)&&t.push(i)}}(e),t}isImportantFile(e){return Boolean(["README.md","package.json","tsconfig.json","index.ts","index.js","main.ts","main.js","app.ts","app.js"].includes(e)||e.endsWith(".d.ts")||e.match(/^index\.[jt]sx?$/))}shouldIgnore(e){return["node_modules",".git","dist","build",".DS_Store","coverage"].includes(e)||e.startsWith(".")}getDocumentationPath(e){const t=a.dirname(e),n=a.basename(e,a.extname(e));return a.join(t,`${n}.md`)}}},65:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateOptions=function(e,t){if("function"==typeof e)t.callback=e;else if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}},79:(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.diffCss=function(e,t,n){return i.diff(e,t,n)},t.cssDiff=void 0;var i=new(((r=n(255))&&r.__esModule?r:{default:r}).default);t.cssDiff=i,i.tokenize=function(e){return e.split(/([{}:;,]|\s+)/)}},86:e=>{e.exports=require("ws")},130:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.TestAgent=void 0;const a=o(n(398)),c=o(n(928));t.TestAgent=class{constructor(){this.id="test-agent",this.name="Test Agent",this.description="Generates and updates test files for your code",this.commandPrefix="@test",this.terminal=null}canHandle(e){return e.startsWith(this.commandPrefix)}async execute(e){try{const{filePath:t,originalContent:n,geminiService:r,fileService:i}=e;if(!t||!n)return{success:!1,message:"Missing required file information"};const s=this.getTestFilePath(t);let o="";try{o=await i.readFile(s)}catch(e){}const a=this.createTestContext(t,n,o,e.prompt||""),c=await r.generateResponse([{role:"user",content:a}]),{code:l,stats:d}=this.extractTestCodeAndStats(c);return await i.writeFile(s,l),{success:!0,message:`Tests ${o?"updated":"created"} at ${s}\n${await this.runTests(s)}`,content:l,testStats:d}}catch(e){return{success:!1,message:`Error in TestAgent: ${e instanceof Error?e.message:String(e)}`}}}getTestFilePath(e){const t=c.dirname(e),n=c.extname(e),r=c.basename(e,n);switch(n){case".ts":case".tsx":case".js":case".jsx":default:return c.join(t,`${r}.test${n}`);case".py":return c.join(t,`test_${r}.py`);case".rb":return c.join(t,`${r}_test.rb`)}}createTestContext(e,t,n,r){const i=c.extname(e).toLowerCase(),s=this.detectTestFramework(i,t);return".py"===i?`\nGenerate Python tests for the following source code:\n\nSource file: ${e}\nFramework: ${s}\n\nSource code:\n\`\`\`python\n${t}\n\`\`\`\n\n${n?`Existing tests:\n\`\`\`python\n${n}\n\`\`\`\n`:""}\n\nAdditional requirements: ${r}\n\nInstructions:\n1. Include necessary imports (pytest, unittest, etc.)\n2. Create proper test class if using unittest\n3. Use pytest fixtures if needed\n4. Follow Python testing best practices\n5. Include docstrings for test functions\n6. Add proper assertions\n\nThe test file should start with imports and should be valid Python syntax.\nExample structure:\nimport pytest\nfrom {module} import *\n\ndef test_function():\n    # test code here\n\nPlease provide the complete test file content.\n\nAfter the test code, please provide test statistics in the following format:\n---TEST-STATS---\nTotal: <number>\nFailed: <number>\n`:`\nGenerate tests for the following source code:\n\nSource file: ${e}\nFramework: ${s}\n\nSource code:\n\`\`\`${i}\n${t}\n\`\`\`\n\n${n?`Existing tests:\n\`\`\`${i}\n${n}\n\`\`\`\n`:""}\n\nAdditional requirements: ${r}\n\nInstructions:\n1. Create comprehensive tests that cover the main functionality\n2. Include test cases for edge cases and error conditions\n3. Follow ${s} testing patterns and best practices\n4. Use clear test descriptions that explain what is being tested\n5. Include setup and teardown if needed\n6. Add comments explaining complex test scenarios\n\nPlease provide the complete test file content.\n\nAfter the test code, please provide test statistics in the following format:\n---TEST-STATS---\nTotal: <number>\nFailed: <number>\n`}detectTestFramework(e,t){switch(e){case".ts":case".tsx":case".js":case".jsx":return t.includes("jest")?"Jest":"Mocha";case".py":return t.includes("pytest")?"pytest":"unittest";case".rb":return"RSpec";case".go":return"testing";case".java":return"JUnit";default:return"Jest"}}extractTestCode(e){const t=Array.from(e.matchAll(/```(?:[\w-]*\n)?([\s\S]*?)```/g));return t.length>0?t.reduce(((e,t)=>t[1].length>e.length?t[1]:e),"").trim():e}extractTestCodeAndStats(e){const t=e.match(/---TEST-STATS---\s*Total:\s*(\d+)\s*Failed:\s*(\d+)/),n={total:0,failed:0};t&&(n.total=parseInt(t[1],10),n.failed=parseInt(t[2],10));const r=e.replace(/---TEST-STATS---[\s\S]*$/,"").trim();return{code:this.extractTestCode(r),stats:n}}async runTests(e){const t=c.extname(e);if(!this.getTestCommand(t,e))return"Test running not supported for this file type";const n=a.workspace.workspaceFolders?.[0];if(!n)return"Error: No workspace folder found";const r=c.isAbsolute(e)?e:c.join(n.uri.fsPath,e);if(".py"===t)try{const e=a.Uri.file(r);await a.workspace.fs.stat(e)}catch(e){return`Error: Test file not found at ${r}. Make sure the file exists and you have correct permissions.`}if(this.terminal||(this.terminal=a.window.createTerminal("Test Runner")),this.terminal.show(),".py"===t){const e=c.join(n.uri.fsPath,"venv"),t="win32"===process.platform?`${e}\\Scripts\\activate`:`source ${e}/bin/activate`;await this.pathExists(e)&&this.terminal.sendText(t)}const i=this.getTestCommand(t,r);return this.terminal.sendText(i),`Running tests with command: ${i}`}async pathExists(e){try{return await a.workspace.fs.stat(a.Uri.file(e)),!0}catch{return!1}}getTestCommand(e,t){const n=t.includes(" ")?`"${t}"`:t;switch(e){case".ts":case".tsx":case".js":case".jsx":return`jest ${n}`;case".py":return`python -m pytest ${n} -v`;case".rb":return`rspec ${n}`;case".go":return`go test ${n}`;case".java":return`./gradlew test --tests "${n}"`;default:return""}}async validate(e){if(!e.filePath||!e.originalContent)return!1;const t=c.extname(e.filePath).toLowerCase();return[".ts",".tsx",".js",".jsx",".py",".rb",".go",".java"].includes(t)}}},196:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.DevToolsAgent=void 0;const a=o(n(86)),c=o(n(398)),l=n(29),d=n(326),u=n(960),f=n(839);t.DevToolsAgent=class{constructor(e){this.id="devtools-agent",this.name="DevTools Agent",this.description="Integrates with Chrome DevTools for real-time UI assistance",this.commandPrefix="@ui",this.wsServer=null,this.clients=new Set,this._context=e,this.chromeDevTools=new l.ChromeDevTools,this.outputChannel=c.window.createOutputChannel("Momo DevTools"),this.diagnosticsCollection=c.languages.createDiagnosticCollection("momo-devtools"),this.setupWebSocketServer()}setupWebSocketServer(){try{this.wsServer=new a.WebSocketServer({port:9229}),this.outputChannel.appendLine("DevTools WebSocket server started on port 9229"),this.wsServer.on("connection",(e=>{this.clients.add(e),this.outputChannel.appendLine("New DevTools client connected"),e.on("message",(async e=>{try{const t=JSON.parse(e.toString());await this.handleDevToolsMessage(t)}catch(e){this.outputChannel.appendLine(`Error handling message: ${e}`)}})),e.on("close",(()=>{this.clients.delete(e),this.outputChannel.appendLine("DevTools client disconnected")}))}))}catch(e){this.outputChannel.appendLine(`Error setting up WebSocket server: ${e}`)}}async handleDevToolsMessage(e){try{if("edit-request"===e.type&&e.filePath&&e.originalContent)await this.handleEditRequest(e);else{const t=this.createAIPrompt(e),n=await this._geminiService.generateResponse([{role:"system",content:"You are a UI/UX expert analyzing web applications."},{role:"user",content:t}]);switch(e.type){case"ui-suggestion":await this.handleUISuggestion(e.suggestion,n);break;case"error-report":await this.handleErrorReport(e.error,n);break;case"test-request":await this.handleTestRequest(e.component,n)}}}catch(e){this.outputChannel.appendLine(`Error processing message with AI: ${e}`)}}async handleEditRequest(e){const t=new d.EditAgent,n={filePath:e.filePath,originalContent:e.originalContent,prompt:e.prompt||"",geminiService:this._geminiService,fileService:new u.FileService(this._context),diffService:new f.DiffService},r=await t.execute(n);this.broadcastToDevTools({type:"edit-response",success:r.success,message:r.message,changes:r.content})}createAIPrompt(e){switch(e.type){case"ui-suggestion":return`Analyze this UI element and provide improvements:\nElement: ${e.suggestion?.selector}\nCurrent state: ${e.suggestion?.recommendation}\nPriority: ${e.suggestion?.priority}\n\nProvide specific suggestions for:\n1. Accessibility improvements\n2. UX enhancements\n3. Performance optimizations\n4. Best practices compliance`;case"error-report":return`Analyze this error and suggest fixes:\nError type: ${e.error?.type}\nMessage: ${e.error?.message}\nStack trace: ${e.error?.stack}\nElement: ${e.error?.selector}\n\nProvide:\n1. Root cause analysis\n2. Potential fixes\n3. Prevention strategies\n4. Testing recommendations`;case"test-request":return`Generate test cases for this component:\nComponent: ${e.component?.name}\nSelector: ${e.component?.selector}\nInteractions: ${e.component?.interactions?.join(", ")}\n\nInclude:\n1. Unit tests\n2. Integration tests\n3. E2E test scenarios\n4. Accessibility tests`;default:return""}}async handleUISuggestion(e,t){const n={...e,aiAnalysis:t,timestamp:(new Date).toISOString()};this.broadcastToDevTools({type:"ui-suggestion-enhanced",suggestion:n}),c.window.showInformationMessage(`UI Suggestion for ${e.selector}: ${t.split("\n")[0]}`,"View Details").then((e=>{"View Details"===e&&this.showDetailedAnalysis(n)}))}async handleErrorReport(e,t){const n={...e,aiAnalysis:t,timestamp:(new Date).toISOString()};this.broadcastToDevTools({type:"error-report-enhanced",error:n}),this.showInProblemsPanel(n)}async handleTestRequest(e,t){const n=this.parseTestCases(t),r={...e,generatedTests:n,timestamp:(new Date).toISOString()};this.broadcastToDevTools({type:"test-cases-generated",test:r}),await this.createTestFile(e.name,n)}broadcastToDevTools(e){"edit-response"===e.type&&this.outputChannel.appendLine(`Broadcasting edit response: ${JSON.stringify(e)}`);const t=JSON.stringify(e);this.clients.forEach((e=>{e.readyState===a.default.OPEN&&e.send(t)}))}canHandle(e){return e.startsWith(this.commandPrefix)}async execute(e){this._geminiService=e.geminiService;try{const{prompt:t}=e;if(!t)return{success:!1,message:"No UI command provided"};const[n,...r]=t.split(" ");switch(n){case"@ui-analyze":return this.analyzeUI(r.join(" "));case"@ui-fix":return this.fixUIIssue(r.join(" "),e);case"@ui-test":return this.generateUITests(r.join(" "),e);default:return{success:!1,message:"Unknown UI command"}}}catch(e){return{success:!1,message:`Error in DevToolsAgent: ${e instanceof Error?e.message:String(e)}`}}}async analyzeUI(e){try{const t=await this.chromeDevTools.analyzeUI(e),n=`Analyze this UI element and provide improvements:\nElement: ${e}\nCurrent state: ${JSON.stringify(t,null,2)}\n\nProvide specific suggestions for:\n1. Accessibility (WCAG compliance)\n2. UX improvements\n3. Performance optimizations\n4. Best practices`;return{success:!0,message:await this._geminiService.generateResponse([{role:"system",content:"You are a UI/UX expert analyzing web applications."},{role:"user",content:n}]),content:JSON.stringify(t,null,2)}}catch(e){return{success:!1,message:`Error analyzing UI: ${e}`}}}async fixUIIssue(e,t){return{success:!0,message:"UI fix applied"}}async generateUITests(e,t){return{success:!0,message:"UI tests generated"}}showDetailedAnalysis(e){c.window.createWebviewPanel("uiAnalysis","UI Analysis Details",c.ViewColumn.Two,{enableScripts:!0}).webview.html=this.getAnalysisHtml(e)}showInProblemsPanel(e){const t=new c.Diagnostic(new c.Range(0,0,0,0),e.aiAnalysis,c.DiagnosticSeverity.Error);(new Map).set("DevTools",[t]),this.diagnosticsCollection||(this.diagnosticsCollection=c.languages.createDiagnosticCollection("momo-devtools")),this.diagnosticsCollection.set(c.Uri.parse("devtools://errors"),[t])}parseTestCases(e){return e.split("\n").filter((e=>e.startsWith("test"))).map((e=>{const[t,...n]=e.split(":");return{name:t.trim(),description:n.join(":").trim()}}))}async createTestFile(e,t){const n=this.generateTestFileContent(e,t),r=`tests/${e}.test.ts`;await c.workspace.fs.writeFile(c.Uri.file(r),Buffer.from(n))}getAnalysisHtml(e){return`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset="UTF-8">\n          <meta name="viewport" content="width=device-width, initial-scale=1.0">\n          <title>UI Analysis</title>\n          <style>\n            body { font-family: var(--vscode-font-family); }\n            .analysis-item { margin: 1em 0; }\n            .timestamp { color: var(--vscode-descriptionForeground); }\n          </style>\n        </head>\n        <body>\n          <h2>UI Analysis Details</h2>\n          <div class="timestamp">Generated: ${e.timestamp}</div>\n          <div class="analysis-item">\n            <h3>Element: ${e.selector}</h3>\n            <pre>${e.aiAnalysis}</pre>\n          </div>\n        </body>\n      </html>\n    `}generateTestFileContent(e,t){return`\nimport { test, expect } from '@playwright/test';\n\ndescribe('${e}', () => {\n  ${t.map((e=>`\n  test('${e.name}', async ({ page }) => {\n    // TODO: Implement test\n    // ${e.description}\n  });`)).join("\n")}\n});\n`}dispose(){this.wsServer&&this.wsServer.close(),this.outputChannel.dispose(),this.diagnosticsCollection&&this.diagnosticsCollection.dispose()}}},255:(e,t)=>{function n(){}function r(e,t,n,r,i){for(var s,o=[];t;)o.push(t),s=t.previousComponent,delete t.previousComponent,t=s;o.reverse();for(var a=0,c=o.length,l=0,d=0;a<c;a++){var u=o[a];if(u.removed){if(u.value=e.join(r.slice(d,d+u.count)),d+=u.count,a&&o[a-1].added){var f=o[a-1];o[a-1]=o[a],o[a]=f}}else{if(!u.added&&i){var h=n.slice(l,l+u.count);h=h.map((function(e,t){var n=r[d+t];return n.length>e.length?n:e})),u.value=e.join(h)}else u.value=e.join(n.slice(l,l+u.count));l+=u.count,u.added||(d+=u.count)}}var p=o[c-1];return c>1&&"string"==typeof p.value&&(p.added||p.removed)&&e.equals("",p.value)&&(o[c-2].value+=p.value,o.pop()),o}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,n.prototype={diff:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.callback;"function"==typeof i&&(s=i,i={}),this.options=i;var o=this;function a(e){return s?(setTimeout((function(){s(void 0,e)}),0),!0):e}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e));var c=(t=this.removeEmpty(this.tokenize(t))).length,l=e.length,d=1,u=c+l;i.maxEditLength&&(u=Math.min(u,i.maxEditLength));var f=null!==(n=i.timeout)&&void 0!==n?n:1/0,h=Date.now()+f,p=[{oldPos:-1,lastComponent:void 0}],g=this.extractCommon(p[0],t,e,0);if(p[0].oldPos+1>=l&&g+1>=c)return a([{value:this.join(t),count:t.length}]);var m=-1/0,v=1/0;function y(){for(var n=Math.max(m,-d);n<=Math.min(v,d);n+=2){var i=void 0,s=p[n-1],u=p[n+1];s&&(p[n-1]=void 0);var f=!1;if(u){var h=u.oldPos-n;f=u&&0<=h&&h<c}var y=s&&s.oldPos+1<l;if(f||y){if(i=!y||f&&s.oldPos+1<u.oldPos?o.addToPath(u,!0,void 0,0):o.addToPath(s,void 0,!0,1),g=o.extractCommon(i,t,e,n),i.oldPos+1>=l&&g+1>=c)return a(r(o,i.lastComponent,t,e,o.useLongestToken));p[n]=i,i.oldPos+1>=l&&(v=Math.min(v,n-1)),g+1>=c&&(m=Math.max(m,n+1))}else p[n]=void 0}d++}if(s)!function e(){setTimeout((function(){if(d>u||Date.now()>h)return s();y()||e()}),0)}();else for(;d<=u&&Date.now()<=h;){var w=y();if(w)return w}},addToPath:function(e,t,n,r){var i=e.lastComponent;return i&&i.added===t&&i.removed===n?{oldPos:e.oldPos+r,lastComponent:{count:i.count+1,added:t,removed:n,previousComponent:i.previousComponent}}:{oldPos:e.oldPos+r,lastComponent:{count:1,added:t,removed:n,previousComponent:i}}},extractCommon:function(e,t,n,r){for(var i=t.length,s=n.length,o=e.oldPos,a=o-r,c=0;a+1<i&&o+1<s&&this.equals(t[a+1],n[o+1]);)a++,o++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=o,a},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}}},265:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){console.log("Momo extension is now active!");let t=a.commands.registerCommand("momo.ask",(()=>{a.window.showInformationMessage("Momo Ask Command Triggered")}));e.subscriptions.push(t),h=a.window.createOutputChannel("Momo"),h.show(),h.appendLine("Activating Momo extension...");try{const t=new l.GeminiService(e),n=new d.FileService(e),r=new u.DiffService,i=new f.DevToolsAgent(e);e.subscriptions.push(i);const s=new c.SidebarProvider(e,t,n,r),o=a.window.registerWebviewViewProvider("momoSidebar",s,{webviewOptions:{retainContextWhenHidden:!0}}),p=a.commands.registerCommand("momo.agent",(()=>{a.commands.executeCommand("workbench.view.extension.momo-sidebar"),s.setMode("agent")})),g=a.commands.registerCommand("momo.applyChanges",(()=>{r.applyChanges()})),m=a.commands.registerCommand("momo.rejectChanges",(()=>{r.rejectChanges()})),v=a.commands.registerCommand("momo.devtools",(()=>{a.commands.executeCommand("workbench.view.extension.momo-sidebar"),s.setMode("devtools")}));e.subscriptions.push(o,p,g,m,v,h);const y=a.workspace.getConfiguration("momo");y.get("apiKey")||y.update("apiKey","AIzaSyB4hiLV6LGufxe_FQlH2TnNPZUVyEtTyVA",a.ConfigurationTarget.Global),a.window.showInformationMessage("Momo is now active! Click the Momo icon in the activity bar to get started."),h.appendLine("Momo extension activated successfully!")}catch(e){h.appendLine(`Error activating Momo extension: ${e}`),a.window.showErrorMessage(`Failed to activate Momo: ${e}`)}},t.deactivate=function(){h?.appendLine("Deactivating Momo extension..."),h?.dispose()};const a=o(n(398)),c=n(872),l=n(23),d=n(960),u=n(839),f=n(196);let h},268:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diffLines=function(e,t,n){return o.diff(e,t,n)},t.diffTrimmedLines=function(e,t,n){var r=(0,s.generateOptions)(n,{ignoreWhitespace:!0});return o.diff(e,t,r)},t.lineDiff=void 0;var r,i=(r=n(255))&&r.__esModule?r:{default:r},s=n(65),o=new i.default;t.lineDiff=o,o.tokenize=function(e){this.options.stripTrailingCr&&(e=e.replace(/\r\n/g,"\n"));var t=[],n=e.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var r=0;r<n.length;r++){var i=n[r];r%2&&!this.options.newlineIsToken?t[t.length-1]+=i:(this.options.ignoreWhitespace&&(i=i.trim()),t.push(i))}return t}},321:(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.diffArrays=function(e,t,n){return i.diff(e,t,n)},t.arrayDiff=void 0;var i=new(((r=n(255))&&r.__esModule?r:{default:r}).default);t.arrayDiff=i,i.tokenize=function(e){return e.slice()},i.join=i.removeEmpty=function(e){return e}},326:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.EditAgent=void 0;const a=o(n(928)),c=o(n(398));t.EditAgent=class{constructor(){this.id="edit-agent",this.name="Edit Agent",this.description="Intelligently edits files using LLM",this.commandPrefix="#"}canHandle(e){return e.startsWith(this.commandPrefix)}async execute(e){try{const{filePath:t,prompt:n,geminiService:r,diffService:i}=e;if(!t)return{success:!1,message:"Missing file path"};const s=t.startsWith("#")?t.substring(1):t,o=c.workspace.workspaceFolders?.[0];if(!o)return{success:!1,message:"No workspace folder is open"};const a=c.Uri.joinPath(o.uri,s);let l;try{l=await c.workspace.openTextDocument(a)}catch(e){return{success:!1,message:`Cannot open file ${s}: ${e instanceof Error?e.message:String(e)}`}}const d=l.getText(),u=this.createEditContext(s,d,n||""),f=await r.generateResponse([{role:"user",content:u}]),h=this.extractCodeBlocks(f);if(0===h.length)return{success:!1,message:"No code blocks found in the LLM response."};const p=h.reduce(((e,t)=>t.length>e.length?t:e),"");i.showDiff(s,d,p);const g=await c.window.showTextDocument(l);return await g.edit((e=>{const t=new c.Range(l.positionAt(0),l.positionAt(l.getText().length));e.replace(t,p)})),{success:!0,message:`Changes proposed for ${s}. Please review the diff and apply or reject the changes.`,content:p}}catch(e){return{success:!1,message:`Error in EditAgent: ${e instanceof Error?e.message:String(e)}`}}}extractCodeBlocks(e){const t=/```(?:[\w-]*\n)?([\s\S]*?)```/g,n=[];let r;for(;null!==(r=t.exec(e));){const e=r[1].trim().replace(/\/\/ \.\.\. existing code \.\.\.\n?/g,"").replace(/\/\* \.\.\. existing code \.\.\. \*\/\n?/g,"").replace(/<!-- \.\.\. existing code \.\.\. -->\n?/g,"");n.push(e)}return n}resolveFilePath(e){if(a.isAbsolute(e))return c.Uri.file(e);const t=c.workspace.workspaceFolders;if(!t||0===t.length)throw new Error("No workspace folder is open");return c.Uri.joinPath(t[0].uri,e)}createEditContext(e,t,n){const r=a.extname(e).toLowerCase(),i=this.parseEditTarget(n,t);let s="";return"general"!==i.type&&(s=`\nTarget: ${i.description}\nSpecific instructions:\n- Focus changes only on the specified ${i.type}\n- Preserve all code outside the target area\n- Use markers to clearly indicate the boundaries of your changes\n- If the target doesn't exist, add it in an appropriate location\n`),`\nFile to edit: ${e}\nFile extension: ${r}\nCurrent content:\n\`\`\`\n${t}\n\`\`\`\n\nEdit request: ${n}${s}\n\nInstructions for editing:\n1. Preserve code structure:\n   - Keep all imports, declarations, and dependencies\n   - Maintain proper indentation and formatting\n   - Preserve critical language constructs\n\n2. Editing guidelines:\n   - Make changes only to the specified target area\n   - Keep the overall file structure intact\n   - Match the style and indentation of the original code\n   - Add clear comments explaining significant changes\n   - Return response without file extension in code blocks\n\nPlease provide the complete file content with your edits.`}sanitizeCodeBlock(e,t){return e.replace(new RegExp(`\`\`\`${t}\\n`),"```\n")}parseEditTarget(e,t){const n=e.match(/lines? (\d+)(?:-(\d+))?/i);if(n){const e=parseInt(n[1]),t=n[2]?parseInt(n[2]):e;return{type:"line",lineRange:{start:e,end:t},description:`Lines ${e}${t!==e?`-${t}`:""}`}}const r=e.match(/function\s+(\w+)/i)||e.match(/the\s+(\w+)\s+function/i);if(r)return{type:"function",identifier:r[1],description:`Function ${r[1]}`};const i=e.match(/method\s+(\w+)/i)||e.match(/the\s+(\w+)\s+method/i);if(i)return{type:"method",identifier:i[1],description:`Method ${i[1]}`};const s=e.match(/class\s+(\w+)/i)||e.match(/the\s+(\w+)\s+class/i);if(s)return{type:"class",identifier:s[1],description:`Class ${s[1]}`};const o=e.match(/(\w+)\s+section/i);return o?{type:"section",identifier:o[1].toLowerCase(),description:`${o[1]} section`}:{type:"general",description:"General edit"}}async getOrCreateDocument(e){const t=c.workspace.workspaceFolders?.[0];if(!t)throw new Error("No workspace folder is open");const n=c.Uri.joinPath(t.uri,e);try{return await c.workspace.openTextDocument(n)}catch(e){return await c.workspace.fs.writeFile(n,new Uint8Array),await c.workspace.openTextDocument(n)}}}},398:e=>{e.exports=require("vscode")},422:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diffWords=function(e,t,n){return n=(0,s.generateOptions)(n,{ignoreWhitespace:!0}),c.diff(e,t,n)},t.diffWordsWithSpace=function(e,t,n){return c.diff(e,t,n)},t.wordDiff=void 0;var r,i=(r=n(255))&&r.__esModule?r:{default:r},s=n(65),o=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,a=/\S/,c=new i.default;t.wordDiff=c,c.equals=function(e,t){return this.options.ignoreCase&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t||this.options.ignoreWhitespace&&!a.test(e)&&!a.test(t)},c.tokenize=function(e){for(var t=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&o.test(t[n])&&o.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t}},439:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var r=!0,i=!1,s=!1,o=1;return function a(){if(r&&!s){if(i?o++:r=!1,e+o<=n)return o;s=!0}if(!i)return s||(r=!0),t<=e-o?-o++:(i=!0,a())}}},445:(e,t)=>{var n,r,i,s,o,a,c;t.HarmCategory=void 0,(n=t.HarmCategory||(t.HarmCategory={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HarmBlockThreshold=void 0,(r=t.HarmBlockThreshold||(t.HarmBlockThreshold={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE",t.HarmProbability=void 0,(i=t.HarmProbability||(t.HarmProbability={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",t.BlockReason=void 0,(s=t.BlockReason||(t.BlockReason={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER",t.FinishReason=void 0,(o=t.FinishReason||(t.FinishReason={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.OTHER="OTHER",t.TaskType=void 0,(a=t.TaskType||(t.TaskType={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",a.RETRIEVAL_QUERY="RETRIEVAL_QUERY",a.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",a.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",a.CLASSIFICATION="CLASSIFICATION",a.CLUSTERING="CLUSTERING";class l extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class d extends l{constructor(e,t){super(e),this.response=t}}!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(c||(c={}));class u{constructor(e,t,n,r){this.model=e,this.task=t,this.apiKey=n,this.stream=r}toString(){let e=`https://generativelanguage.googleapis.com/v1/${this.model}:${this.task}`;return this.stream&&(e+="?alt=sse"),e}}async function f(e,t,n){let r;try{if(r=await fetch(e.toString(),Object.assign(Object.assign({},function(e){const t={};if((null==e?void 0:e.timeout)>=0){const n=new AbortController,r=n.signal;setTimeout((()=>n.abort()),e.timeout),t.signal=r}return t}(n)),{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-client":"genai-js/0.2.1","x-goog-api-key":e.apiKey},body:t})),!r.ok){let e="";try{const t=await r.json();e=t.error.message,t.error.details&&(e+=` ${JSON.stringify(t.error.details)}`)}catch(e){}throw new Error(`[${r.status} ${r.statusText}] ${e}`)}}catch(t){const n=new l(`Error fetching from ${e.toString()}: ${t.message}`);throw n.stack=t.stack,n}return r}function h(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),g(e.candidates[0]))throw new d(`${m(e)}`,e);return function(e){var t,n,r,i;return(null===(i=null===(r=null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r[0])||void 0===i?void 0:i.text)?e.candidates[0].content.parts[0].text:""}(e)}if(e.promptFeedback)throw new d(`Text not available. ${m(e)}`,e);return""},e}const p=[t.FinishReason.RECITATION,t.FinishReason.SAFETY];function g(e){return!!e.finishReason&&p.includes(e.finishReason)}function m(e){var t,n,r;let i="";if(e.candidates&&0!==e.candidates.length||!e.promptFeedback){if(null===(r=e.candidates)||void 0===r?void 0:r[0]){const t=e.candidates[0];g(t)&&(i+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(i+=`: ${t.finishMessage}`))}}else i+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(i+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(i+=`: ${e.promptFeedback.blockReasonMessage}`);return i}function v(e){return this instanceof v?(this.v=e,this):new v(e)}"function"==typeof SuppressedError&&SuppressedError;const y=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function w(e){const t=[],n=e.getReader();for(;;){const{done:e,value:r}=await n.read();if(e)return h(P(t));t.push(r)}}function b(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){s.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof v?Promise.resolve(n.value.v).then(c,l):d(s[0][2],n)}catch(e){d(s[0][3],e)}var n}function c(e){a("next",e)}function l(e){a("throw",e)}function d(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,(function*(){const t=e.getReader();for(;;){const{value:e,done:n}=yield v(t.read());if(n)break;yield yield v(h(e))}}))}function P(e){const t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(const t of e)if(t.candidates)for(const e of t.candidates){const t=e.index;if(n.candidates||(n.candidates=[]),n.candidates[t]||(n.candidates[t]={index:e.index}),n.candidates[t].citationMetadata=e.citationMetadata,n.candidates[t].finishReason=e.finishReason,n.candidates[t].finishMessage=e.finishMessage,n.candidates[t].safetyRatings=e.safetyRatings,e.content&&e.content.parts){n.candidates[t].content||(n.candidates[t].content={role:e.content.role||"user",parts:[{text:""}]});for(const r of e.content.parts)r.text&&(n.candidates[t].content.parts[0].text+=r.text)}}return n}async function _(e,t,n,r){const i=new u(t,c.STREAM_GENERATE_CONTENT,e,!0);return function(e){const t=function(e){const t=e.getReader();return new ReadableStream({start(e){let n="";return function r(){return t.read().then((({value:t,done:i})=>{if(i)return n.trim()?void e.error(new l("Failed to parse stream")):void e.close();n+=t;let s,o=n.match(y);for(;o;){try{s=JSON.parse(o[1])}catch(t){return void e.error(new l(`Error parsing JSON response: "${o[1]}"`))}e.enqueue(s),n=n.substring(o[0].length),o=n.match(y)}return r()}))}()}})}(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))),[n,r]=t.tee();return{stream:b(n),response:w(r)}}(await f(i,JSON.stringify(n),r))}async function O(e,t,n,r){const i=new u(t,c.GENERATE_CONTENT,e,!1),s=await f(i,JSON.stringify(n),r);return{response:h(await s.json())}}function E(e,t){let n=[];if("string"==typeof e)n=[{text:e}];else for(const t of e)"string"==typeof t?n.push({text:t}):n.push(t);return{role:t,parts:n}}function S(e){return e.contents?e:{contents:[E(e,"user")]}}const C="SILENT_ERROR";class x{constructor(e,t,n,r){this.model=t,this.params=n,this.requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(this._history=n.history.map((e=>{if(!e.role)throw new Error("Missing role for history item: "+JSON.stringify(e));return E(e.parts,e.role)})))}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,n;await this._sendPromise;const r=E(e,"user"),i={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(n=this.params)||void 0===n?void 0:n.generationConfig,contents:[...this._history,r]};let s;return this._sendPromise=this._sendPromise.then((()=>O(this._apiKey,this.model,i,this.requestOptions))).then((e=>{var t;if(e.response.candidates&&e.response.candidates.length>0){this._history.push(r);const n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{const t=m(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}s=e})),await this._sendPromise,s}async sendMessageStream(e){var t,n;await this._sendPromise;const r=E(e,"user"),i={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(n=this.params)||void 0===n?void 0:n.generationConfig,contents:[...this._history,r]},s=_(this._apiKey,this.model,i,this.requestOptions);return this._sendPromise=this._sendPromise.then((()=>s)).catch((e=>{throw new Error(C)})).then((e=>e.response)).then((e=>{if(e.candidates&&e.candidates.length>0){this._history.push(r);const t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{const t=m(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}})).catch((e=>{e.message!==C&&console.error(e)})),s}}class T{constructor(e,t,n){this.apiKey=e,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.requestOptions=n||{}}async generateContent(e){const t=S(e);return O(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t),this.requestOptions)}async generateContentStream(e){const t=S(e);return _(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t),this.requestOptions)}startChat(e){return new x(this.apiKey,this.model,e,this.requestOptions)}async countTokens(e){const t=S(e);return async function(e,t,n){const r=new u(t,c.COUNT_TOKENS,e,!1);return(await f(r,JSON.stringify(Object.assign(Object.assign({},n),{model:t})),void 0)).json()}(this.apiKey,this.model,t)}async embedContent(e){const t="string"==typeof(n=e)||Array.isArray(n)?{content:E(n,"user")}:n;var n;return async function(e,t,n){const r=new u(t,c.EMBED_CONTENT,e,!1);return(await f(r,JSON.stringify(n),void 0)).json()}(this.apiKey,this.model,t)}async batchEmbedContents(e){return async function(e,t,n,r){const i=new u(t,c.BATCH_EMBED_CONTENTS,e,!1),s=n.requests.map((e=>Object.assign(Object.assign({},e),{model:t})));return(await f(i,JSON.stringify({requests:s}),r)).json()}(this.apiKey,this.model,e,this.requestOptions)}}t.ChatSession=x,t.GenerativeModel=T,t.GoogleGenerativeAI=class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new l("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new T(this.apiKey,e,t)}}},467:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyPatch=o,t.applyPatches=function(e,t){"string"==typeof e&&(e=(0,i.parsePatch)(e));var n=0;!function r(){var i=e[n++];if(!i)return t.complete();t.loadFile(i,(function(e,n){if(e)return t.complete(e);var s=o(n,i,t);t.patched(i,s,(function(e){if(e)return t.complete(e);r()}))}))}()};var r,i=n(20),s=(r=n(439))&&r.__esModule?r:{default:r};function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof t&&(t=(0,i.parsePatch)(t)),Array.isArray(t)){if(t.length>1)throw new Error("applyPatch only works with a single input.");t=t[0]}var r,o,a=e.split(/\r\n|[\n\v\f\r\x85]/),c=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],l=t.hunks,d=n.compareLine||function(e,t,n,r){return t===r},u=0,f=n.fuzzFactor||0,h=0,p=0;function g(e,t){for(var n=0;n<e.lines.length;n++){var r=e.lines[n],i=r.length>0?r[0]:" ",s=r.length>0?r.substr(1):r;if(" "===i||"-"===i){if(!d(t+1,a[t],i,s)&&++u>f)return!1;t++}}return!0}for(var m=0;m<l.length;m++){for(var v=l[m],y=a.length-v.oldLines,w=0,b=p+v.oldStart-1,P=(0,s.default)(b,h,y);void 0!==w;w=P())if(g(v,b+w)){v.offset=p+=w;break}if(void 0===w)return!1;h=v.offset+v.oldStart+v.oldLines}for(var _=0,O=0;O<l.length;O++){var E=l[O],S=E.oldStart+E.offset+_-1;_+=E.newLines-E.oldLines;for(var C=0;C<E.lines.length;C++){var x=E.lines[C],T=x.length>0?x[0]:" ",M=x.length>0?x.substr(1):x,A=E.linedelimiters&&E.linedelimiters[C]||"\n";if(" "===T)S++;else if("-"===T)a.splice(S,1),c.splice(S,1);else if("+"===T)a.splice(S,0,M),c.splice(S,0,A),S++;else if("\\"===T){var j=E.lines[C-1]?E.lines[C-1][0]:null;"+"===j?r=!0:"-"===j&&(o=!0)}}}if(r)for(;!a[a.length-1];)a.pop(),c.pop();else o&&(a.push(""),c.push("\n"));for(var F=0;F<a.length-1;F++)a[F]=a[F]+c[F];return a.join("")}},477:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentRegistry=void 0;const r=n(196),i=n(37);class s{constructor(e){this.agents=new Map,this.context=e,this.registerBuiltinAgents()}registerBuiltinAgents(){try{this.registerAgent(new r.DevToolsAgent(this.context)),this.registerAgent(new i.RunAgent);try{const{ErrorFixAgent:e}=n(849),{FileManagementAgent:t}=n(657);this.registerAgent(new e),this.registerAgent(new t)}catch(e){console.log("Optional agents not available:",e)}}catch(e){console.error("Error registering built-in agents:",e)}}static getInstance(e){return s.instance||(s.instance=new s(e)),s.instance}registerAgent(e){if(this.agents.has(e.id))throw new Error(`Agent with ID ${e.id} is already registered`);this.agents.set(e.id,e)}getAgent(e){return this.agents.get(e)}getAllAgents(){return Array.from(this.agents.values())}findAgentForInput(e){return Array.from(this.agents.values()).find((t=>t.canHandle(e)))}}t.AgentRegistry=s},546:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Diff",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"diffChars",{enumerable:!0,get:function(){return s.diffChars}}),Object.defineProperty(t,"diffWords",{enumerable:!0,get:function(){return o.diffWords}}),Object.defineProperty(t,"diffWordsWithSpace",{enumerable:!0,get:function(){return o.diffWordsWithSpace}}),Object.defineProperty(t,"diffLines",{enumerable:!0,get:function(){return a.diffLines}}),Object.defineProperty(t,"diffTrimmedLines",{enumerable:!0,get:function(){return a.diffTrimmedLines}}),Object.defineProperty(t,"diffSentences",{enumerable:!0,get:function(){return c.diffSentences}}),Object.defineProperty(t,"diffCss",{enumerable:!0,get:function(){return l.diffCss}}),Object.defineProperty(t,"diffJson",{enumerable:!0,get:function(){return d.diffJson}}),Object.defineProperty(t,"canonicalize",{enumerable:!0,get:function(){return d.canonicalize}}),Object.defineProperty(t,"diffArrays",{enumerable:!0,get:function(){return u.diffArrays}}),Object.defineProperty(t,"applyPatch",{enumerable:!0,get:function(){return f.applyPatch}}),Object.defineProperty(t,"applyPatches",{enumerable:!0,get:function(){return f.applyPatches}}),Object.defineProperty(t,"parsePatch",{enumerable:!0,get:function(){return h.parsePatch}}),Object.defineProperty(t,"merge",{enumerable:!0,get:function(){return p.merge}}),Object.defineProperty(t,"reversePatch",{enumerable:!0,get:function(){return g.reversePatch}}),Object.defineProperty(t,"structuredPatch",{enumerable:!0,get:function(){return m.structuredPatch}}),Object.defineProperty(t,"createTwoFilesPatch",{enumerable:!0,get:function(){return m.createTwoFilesPatch}}),Object.defineProperty(t,"createPatch",{enumerable:!0,get:function(){return m.createPatch}}),Object.defineProperty(t,"formatPatch",{enumerable:!0,get:function(){return m.formatPatch}}),Object.defineProperty(t,"convertChangesToDMP",{enumerable:!0,get:function(){return v.convertChangesToDMP}}),Object.defineProperty(t,"convertChangesToXML",{enumerable:!0,get:function(){return y.convertChangesToXML}});var r,i=(r=n(255))&&r.__esModule?r:{default:r},s=n(687),o=n(422),a=n(268),c=n(883),l=n(79),d=n(728),u=n(321),f=n(467),h=n(20),p=n(555),g=n(769),m=n(723),v=n(583),y=n(591)},555:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calcLineCount=c,t.merge=function(e,t,n){e=l(e,n),t=l(t,n);var r={};(e.index||t.index)&&(r.index=e.index||t.index),(e.newFileName||t.newFileName)&&(d(e)?d(t)?(r.oldFileName=u(r,e.oldFileName,t.oldFileName),r.newFileName=u(r,e.newFileName,t.newFileName),r.oldHeader=u(r,e.oldHeader,t.oldHeader),r.newHeader=u(r,e.newHeader,t.newHeader)):(r.oldFileName=e.oldFileName,r.newFileName=e.newFileName,r.oldHeader=e.oldHeader,r.newHeader=e.newHeader):(r.oldFileName=t.oldFileName||e.oldFileName,r.newFileName=t.newFileName||e.newFileName,r.oldHeader=t.oldHeader||e.oldHeader,r.newHeader=t.newHeader||e.newHeader)),r.hunks=[];for(var i=0,s=0,o=0,a=0;i<e.hunks.length||s<t.hunks.length;){var c=e.hunks[i]||{oldStart:1/0},g=t.hunks[s]||{oldStart:1/0};if(f(c,g))r.hunks.push(h(c,o)),i++,a+=c.newLines-c.oldLines;else if(f(g,c))r.hunks.push(h(g,a)),s++,o+=g.newLines-g.oldLines;else{var m={oldStart:Math.min(c.oldStart,g.oldStart),oldLines:0,newStart:Math.min(c.newStart+o,g.oldStart+a),newLines:0,lines:[]};p(m,c.oldStart,c.lines,g.oldStart,g.lines),s++,i++,r.hunks.push(m)}}return r};var r=n(723),i=n(20),s=n(750);function o(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e){var t=O(e.lines),n=t.oldLines,r=t.newLines;void 0!==n?e.oldLines=n:delete e.oldLines,void 0!==r?e.newLines=r:delete e.newLines}function l(e,t){if("string"==typeof e){if(/^@@/m.test(e)||/^Index:/m.test(e))return(0,i.parsePatch)(e)[0];if(!t)throw new Error("Must provide a base reference or pass in a patch");return(0,r.structuredPatch)(void 0,void 0,t,e)}return e}function d(e){return e.newFileName&&e.newFileName!==e.oldFileName}function u(e,t,n){return t===n?t:(e.conflict=!0,{mine:t,theirs:n})}function f(e,t){return e.oldStart<t.oldStart&&e.oldStart+e.oldLines<t.oldStart}function h(e,t){return{oldStart:e.oldStart,oldLines:e.oldLines,newStart:e.newStart+t,newLines:e.newLines,lines:e.lines}}function p(e,t,n,r,i){var s={offset:t,lines:n,index:0},a={offset:r,lines:i,index:0};for(y(e,s,a),y(e,a,s);s.index<s.lines.length&&a.index<a.lines.length;){var l=s.lines[s.index],d=a.lines[a.index];if("-"!==l[0]&&"+"!==l[0]||"-"!==d[0]&&"+"!==d[0])if("+"===l[0]&&" "===d[0]){var u;(u=e.lines).push.apply(u,o(b(s)))}else if("+"===d[0]&&" "===l[0]){var f;(f=e.lines).push.apply(f,o(b(a)))}else"-"===l[0]&&" "===d[0]?m(e,s,a):"-"===d[0]&&" "===l[0]?m(e,a,s,!0):l===d?(e.lines.push(l),s.index++,a.index++):v(e,b(s),b(a));else g(e,s,a)}w(e,s),w(e,a),c(e)}function g(e,t,n){var r=b(t),i=b(n);if(P(r)&&P(i)){var a,c;if((0,s.arrayStartsWith)(r,i)&&_(n,r,r.length-i.length))return void(a=e.lines).push.apply(a,o(r));if((0,s.arrayStartsWith)(i,r)&&_(t,i,i.length-r.length))return void(c=e.lines).push.apply(c,o(i))}else if((0,s.arrayEqual)(r,i)){var l;return void(l=e.lines).push.apply(l,o(r))}v(e,r,i)}function m(e,t,n,r){var i,s=b(t),a=function(e,t){for(var n=[],r=[],i=0,s=!1,o=!1;i<t.length&&e.index<e.lines.length;){var a=e.lines[e.index],c=t[i];if("+"===c[0])break;if(s=s||" "!==a[0],r.push(c),i++,"+"===a[0])for(o=!0;"+"===a[0];)n.push(a),a=e.lines[++e.index];c.substr(1)===a.substr(1)?(n.push(a),e.index++):o=!0}if("+"===(t[i]||"")[0]&&s&&(o=!0),o)return n;for(;i<t.length;)r.push(t[i++]);return{merged:r,changes:n}}(n,s);a.merged?(i=e.lines).push.apply(i,o(a.merged)):v(e,r?a:s,r?s:a)}function v(e,t,n){e.conflict=!0,e.lines.push({conflict:!0,mine:t,theirs:n})}function y(e,t,n){for(;t.offset<n.offset&&t.index<t.lines.length;){var r=t.lines[t.index++];e.lines.push(r),t.offset++}}function w(e,t){for(;t.index<t.lines.length;){var n=t.lines[t.index++];e.lines.push(n)}}function b(e){for(var t=[],n=e.lines[e.index][0];e.index<e.lines.length;){var r=e.lines[e.index];if("-"===n&&"+"===r[0]&&(n="+"),n!==r[0])break;t.push(r),e.index++}return t}function P(e){return e.reduce((function(e,t){return e&&"-"===t[0]}),!0)}function _(e,t,n){for(var r=0;r<n;r++){var i=t[t.length-n+r].substr(1);if(e.lines[e.index+r]!==" "+i)return!1}return e.index+=n,!0}function O(e){var t=0,n=0;return e.forEach((function(e){if("string"!=typeof e){var r=O(e.mine),i=O(e.theirs);void 0!==t&&(r.oldLines===i.oldLines?t+=r.oldLines:t=void 0),void 0!==n&&(r.newLines===i.newLines?n+=r.newLines:n=void 0)}else void 0===n||"+"!==e[0]&&" "!==e[0]||n++,void 0===t||"-"!==e[0]&&" "!==e[0]||t++})),{oldLines:t,newLines:n}}},583:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertChangesToDMP=function(e){for(var t,n,r=[],i=0;i<e.length;i++)n=(t=e[i]).added?1:t.removed?-1:0,r.push([n,t.value]);return r}},591:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertChangesToXML=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];r.added?t.push("<ins>"):r.removed&&t.push("<del>"),t.push((i=r.value,i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"))),r.added?t.push("</ins>"):r.removed&&t.push("</del>")}var i;return t.join("")}},657:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.FileManagementAgent=void 0;const a=o(n(398));t.FileManagementAgent=class{constructor(){this.id="file-management-agent",this.name="File Management Agent",this.description="Creates and deletes files and folders",this.commandPrefix="@"}canHandle(e){return["@createfile","@createfolder","@deletefile","@deletefolder"].some((t=>e.toLowerCase().startsWith(t)))}async execute(e){try{const{prompt:t}=e;if(!t)return{success:!1,message:"No command provided"};const n=a.workspace.workspaceFolders?.[0];if(!n)return{success:!1,message:"No workspace folder found"};const r=/^@(createfile|createfolder|deletefile|deletefolder)\s+(.+)$/i,i=t.match(r);if(!i)return{success:!1,message:"Invalid command format. Use @createfile <filename> or @createfolder <foldername>"};const[,s,o]=i;if(!o||0===o.trim().length)return{success:!1,message:"No name provided"};const c=a.Uri.joinPath(n.uri,o.trim());try{switch(s.toLowerCase()){case"createfile":return await a.workspace.fs.writeFile(c,new Uint8Array),{success:!0,message:`File created: ${o} in ${n.name}`};case"createfolder":return await a.workspace.fs.createDirectory(c),{success:!0,message:`Folder created: ${o} in ${n.name}`};case"deletefile":return await a.workspace.fs.delete(c,{useTrash:!0}),{success:!0,message:`File deleted: ${o} from ${n.name}`};case"deletefolder":return await a.workspace.fs.delete(c,{recursive:!0,useTrash:!0}),{success:!0,message:`Folder deleted: ${o} from ${n.name}`};default:return{success:!1,message:"Invalid command"}}}catch(e){return{success:!1,message:`Operation failed: ${e instanceof Error?e.message:String(e)}`}}}catch(e){return{success:!1,message:`Error: ${e instanceof Error?e.message:String(e)}`}}}async validate(e){return!!e.prompt&&this.canHandle(e.prompt)}}},687:(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.diffChars=function(e,t,n){return i.diff(e,t,n)},t.characterDiff=void 0;var i=new(((r=n(255))&&r.__esModule?r:{default:r}).default);t.characterDiff=i},723:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.structuredPatch=o,t.formatPatch=a,t.createTwoFilesPatch=c,t.createPatch=function(e,t,n,r,i,s){return c(e,e,t,n,r,i,s)};var r=n(268);function i(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t,n,s,o,a,c){c||(c={}),void 0===c.context&&(c.context=4);var l=(0,r.diffLines)(n,s,c);if(l){l.push({value:"",lines:[]});for(var d=[],u=0,f=0,h=[],p=1,g=1,m=function(e){var t=l[e],r=t.lines||t.value.replace(/\n$/,"").split("\n");if(t.lines=r,t.added||t.removed){var o;if(!u){var a=l[e-1];u=p,f=g,a&&(h=c.context>0?y(a.lines.slice(-c.context)):[],u-=h.length,f-=h.length)}(o=h).push.apply(o,i(r.map((function(e){return(t.added?"+":"-")+e})))),t.added?g+=r.length:p+=r.length}else{if(u)if(r.length<=2*c.context&&e<l.length-2){var m;(m=h).push.apply(m,i(y(r)))}else{var v,w=Math.min(r.length,c.context);(v=h).push.apply(v,i(y(r.slice(0,w))));var b={oldStart:u,oldLines:p-u+w,newStart:f,newLines:g-f+w,lines:h};if(e>=l.length-2&&r.length<=c.context){var P=/\n$/.test(n),_=/\n$/.test(s),O=0==r.length&&h.length>b.oldLines;!P&&O&&n.length>0&&h.splice(b.oldLines,0,"\\ No newline at end of file"),(P||O)&&_||h.push("\\ No newline at end of file")}d.push(b),u=0,f=0,h=[]}p+=r.length,g+=r.length}},v=0;v<l.length;v++)m(v);return{oldFileName:e,newFileName:t,oldHeader:o,newHeader:a,hunks:d}}function y(e){return e.map((function(e){return" "+e}))}}function a(e){if(Array.isArray(e))return e.map(a).join("\n");var t=[];e.oldFileName==e.newFileName&&t.push("Index: "+e.oldFileName),t.push("==================================================================="),t.push("--- "+e.oldFileName+(void 0===e.oldHeader?"":"\t"+e.oldHeader)),t.push("+++ "+e.newFileName+(void 0===e.newHeader?"":"\t"+e.newHeader));for(var n=0;n<e.hunks.length;n++){var r=e.hunks[n];0===r.oldLines&&(r.oldStart-=1),0===r.newLines&&(r.newStart-=1),t.push("@@ -"+r.oldStart+","+r.oldLines+" +"+r.newStart+","+r.newLines+" @@"),t.push.apply(t,r.lines)}return t.join("\n")+"\n"}function c(e,t,n,r,i,s,c){return a(o(e,t,n,r,i,s,c))}},728:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diffJson=function(e,t,n){return c.diff(e,t,n)},t.canonicalize=l,t.jsonDiff=void 0;var r,i=(r=n(255))&&r.__esModule?r:{default:r},s=n(268);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}var a=Object.prototype.toString,c=new i.default;function l(e,t,n,r,i){var s,c;for(t=t||[],n=n||[],r&&(e=r(i,e)),s=0;s<t.length;s+=1)if(t[s]===e)return n[s];if("[object Array]"===a.call(e)){for(t.push(e),c=new Array(e.length),n.push(c),s=0;s<e.length;s+=1)c[s]=l(e[s],t,n,r,i);return t.pop(),n.pop(),c}if(e&&e.toJSON&&(e=e.toJSON()),"object"===o(e)&&null!==e){t.push(e),c={},n.push(c);var d,u=[];for(d in e)e.hasOwnProperty(d)&&u.push(d);for(u.sort(),s=0;s<u.length;s+=1)c[d=u[s]]=l(e[d],t,n,r,d);t.pop(),n.pop()}else c=e;return c}t.jsonDiff=c,c.useLongestToken=!0,c.tokenize=s.lineDiff.tokenize,c.castInput=function(e){var t=this.options,n=t.undefinedReplacement,r=t.stringifyReplacer,i=void 0===r?function(e,t){return void 0===t?n:t}:r;return"string"==typeof e?e:JSON.stringify(l(e,null,null,i),i,"  ")},c.equals=function(e,t){return i.default.prototype.equals.call(c,e.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))}},750:(e,t)=>{function n(e,t){if(t.length>e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.arrayEqual=function(e,t){return e.length===t.length&&n(e,t)},t.arrayStartsWith=n},769:(e,t)=>{function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function r(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.reversePatch=function e(t){return Array.isArray(t)?t.map(e).reverse():r(r({},t),{},{oldFileName:t.newFileName,oldHeader:t.newHeader,newFileName:t.oldFileName,newHeader:t.oldHeader,hunks:t.hunks.map((function(e){return{oldLines:e.newLines,oldStart:e.newStart,newLines:e.oldLines,newStart:e.oldStart,linedelimiters:e.linedelimiters,lines:e.lines.map((function(e){return e.startsWith("-")?"+".concat(e.slice(1)):e.startsWith("+")?"-".concat(e.slice(1)):e}))}}))})}},839:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.DiffService=void 0;const a=o(n(398)),c=o(n(546)),l=n(546);t.DiffService=class{constructor(){this.pendingChanges=new Map,this.changes=new Map,this.diffPanel=null}createDiff(e,t,n){const r=this.stripFileExtension(e),i=this.getFileUri(e),s=c.diffLines(t,n);let o=`<div class="diff-container">\n      <div class="diff-header">${r}</div>\n      <div class="diff-content">`;for(const e of s)e.added?o+=`<div class="diff-line diff-added">+ ${this.escapeHtml(e.value)}</div>`:e.removed?o+=`<div class="diff-line diff-removed">- ${this.escapeHtml(e.value)}</div>`:o+=`<div class="diff-line diff-unchanged"> ${this.escapeHtml(e.value)}</div>`;return o+="</div></div>",this.pendingChanges.set(i.toString(),{uri:i,originalContent:t,newContent:n,diffHtml:o}),o}showDiff(e,t,n){const r=this.createDiff(e,t,n);this.diffPanel||(this.diffPanel=a.window.createWebviewPanel("momoDiff","Momo: File Changes",a.ViewColumn.Two,{enableScripts:!0,retainContextWhenHidden:!0}),this.diffPanel.onDidDispose((()=>{this.diffPanel=null})));const i=`\n      <!DOCTYPE html>\n      <html lang="en">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Momo: File Changes</title>\n        \n      <style>\n        body { font-family: var(--vscode-editor-font-family); font-size: var(--vscode-editor-font-size); }\n        .diff-container { margin-bottom: 20px; border: 1px solid var(--vscode-panel-border); }\n        .diff-header { background-color: var(--vscode-editor-background); padding: 8px; font-weight: bold; border-bottom: 1px solid var(--vscode-panel-border); }\n        .diff-content { white-space: pre; font-family: monospace; }\n        .diff-line { padding: 0 8px; }\n        .diff-added { background-color: rgba(0, 255, 0, 0.1); color: var(--vscode-gitDecoration-addedResourceForeground); }\n        .diff-removed { background-color: rgba(255, 0, 0, 0.1); color: var(--vscode-gitDecoration-deletedResourceForeground); }\n        .diff-unchanged { color: var(--vscode-editor-foreground); }\n        .actions { margin-top: 20px; display: flex; gap: 10px; }\n        button { padding: 8px 16px; cursor: pointer; background-color: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; }\n        button:hover { background-color: var(--vscode-button-hoverBackground); }\n      </style>\n    \n      </head>\n      <body>\n        <h2>Proposed Changes</h2>\n        ${r}\n        <div class="actions">\n          <button id="apply">Apply Changes</button>\n          <button id="reject">Reject Changes</button>\n        </div>\n        <script>\n          const vscode = acquireVsCodeApi();\n          document.getElementById('apply').addEventListener('click', () => {\n            vscode.postMessage({ command: 'apply' });\n          });\n          document.getElementById('reject').addEventListener('click', () => {\n            vscode.postMessage({ command: 'reject' });\n          });\n        <\/script>\n      </body>\n      </html>\n    `;this.diffPanel.webview.html=i,this.diffPanel.webview.onDidReceiveMessage((e=>{switch(e.command){case"apply":a.commands.executeCommand("momo.applyChanges");break;case"reject":a.commands.executeCommand("momo.rejectChanges")}}))}async applyChanges(){for(const[e,t]of[...this.pendingChanges.entries(),...this.changes.entries()])try{const n="string"==typeof t?a.Uri.parse(e):t.uri,r="string"==typeof t?t:t.newContent,i=await a.workspace.openTextDocument(n),s=new a.WorkspaceEdit,o=new a.Range(i.positionAt(0),i.positionAt(i.getText().length));s.replace(n,o,r),await a.workspace.applyEdit(s);const c=this.stripFileExtension(n.fsPath);a.window.showInformationMessage(`Changes applied to ${c}`)}catch(n){const r=this.stripFileExtension("string"==typeof t?e:t.uri.fsPath);a.window.showErrorMessage(`Failed to apply changes to ${r}: ${n}`)}this.clearChanges()}rejectChanges(){this.clearChanges(),a.window.showInformationMessage("Changes rejected")}clearChanges(){this.pendingChanges.clear(),this.changes.clear(),this.diffPanel&&(this.diffPanel.dispose(),this.diffPanel=null)}getFileUri(e){const t=a.workspace.workspaceFolders;if(!t||0===t.length)throw new Error("No workspace folder is open");return a.Uri.joinPath(t[0].uri,e)}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}stripFileExtension(e){const t=e.lastIndexOf(".");return t>Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"))&&-1!==t?e.substring(0,t):e}async previewChanges(e,t,n){this.changes.set(n.toString(),t);const r=(0,l.createPatch)(n.fsPath,e,t),i=await a.workspace.openTextDocument({content:r,language:"diff"});await a.window.showTextDocument(i,{preview:!0})}}},849:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorFixAgent=void 0;const a=o(n(398));class c{constructor(){if(this.id="error-fix-agent",this.name="Error Fix Agent",this.description="Automatically detects and fixes errors in your code",this.commandPrefix="@fix",this.terminal=null,this.errorBuffer=[],this.isProcessingError=!1,this.lastActiveTerminal=null,this.monitoredTerminals=new Set,this.errorMonitorTerminal=null,c.INSTANCE)return c.INSTANCE;c.INSTANCE=this,a.window.onDidOpenTerminal((e=>{this.setupTerminalListener(e)})),a.window.terminals.forEach((e=>{this.setupTerminalListener(e)})),a.languages.onDidChangeDiagnostics((e=>{this.handleDiagnosticsChange(e)})),a.window.onDidCloseTerminal((e=>{this.monitoredTerminals.delete(e.name),e===this.errorMonitorTerminal&&(this.errorMonitorTerminal=null)}))}setupTerminalListener(e){this.monitoredTerminals.has(e.name)||"Error Monitor"===e.name||(this.monitoredTerminals.add(e.name),a.window.onDidChangeActiveTerminal((e=>{e&&(this.lastActiveTerminal=e)})),e.processId.then((t=>{t&&this.attachTerminalListener(e)})))}attachTerminalListener(e){const t={onDidWrite:(new a.EventEmitter).event,open:()=>{},close:()=>{},handleInput:t=>{t.toLowerCase().includes("fix")&&t.toLowerCase().includes("bug")&&this.handleFixCommand(e)}};this.errorMonitorTerminal||(this.errorMonitorTerminal=a.window.createTerminal({name:"Error Monitor",pty:t}))}async handleFixCommand(e){if(!this.lastActiveTerminal)return;const t=a.window.activeTextEditor;if(!t)return void e.sendText("No active file to fix.");const n=t.document.uri,r=a.languages.getDiagnostics(n).filter((e=>e.severity===a.DiagnosticSeverity.Error));if(0===r.length)return void e.sendText("No errors found in the current file.");const i=r.map((e=>({message:e.message,range:e.range,code:e.code})));await this.processError(JSON.stringify(i),n)}async handleTerminalOutput(e){this.terminal&&e.terminal===this.terminal&&await this.handleTerminalData(e.terminal,e.data)}async handleTerminalData(e,t){e&&this.isErrorMessage(t)&&!this.isProcessingError&&(this.errorBuffer.push(t),await new Promise((e=>setTimeout(e,100))),this.errorBuffer.length>0&&(await this.processError(this.errorBuffer.join("\n")),this.errorBuffer=[]))}async handleDiagnosticsChange(e){if(!this.isProcessingError)for(const t of e.uris){const e=a.languages.getDiagnostics(t).filter((e=>e.severity===a.DiagnosticSeverity.Error));if(e.length>0){const n=e.map((e=>({message:e.message,range:e.range,code:e.code})));await this.processError(JSON.stringify(n),t)}}}isErrorMessage(e){return[/error/i,/exception/i,/traceback/i,/failed/i,/syntax error/i].some((t=>t.test(e)))}async processError(e,t){this.isProcessingError=!0;try{const n={filePath:t?.fsPath,originalContent:t?await this.getFileContent(t):void 0,prompt:`Fix this error:\n${e}`,geminiService:void 0,fileService:void 0,diffService:void 0};await this.execute(n)}finally{this.isProcessingError=!1}}async getFileContent(e){return(await a.workspace.openTextDocument(e)).getText()}canHandle(e){return e.startsWith(this.commandPrefix)}async execute(e){try{const{filePath:t,originalContent:n,prompt:r,geminiService:i}=e;if(!t||!n)return{success:!1,message:"Missing file information"};const s=`\nFix the following error in this code:\n\nFile: ${t}\nError: ${r}\n\nOriginal code:\n\`\`\`\n${n}\n\`\`\`\n\nProvide only the fixed code without any explanations.\nIf multiple fixes are possible, provide the most likely fix.\nPreserve the original code structure and style.\n`,o=await i.generateResponse([{role:"user",content:s}]),a=this.extractCode(o);return a&&a!==n?(e.diffService.showDiff(t,n,a),{success:!0,message:"Fix generated. Please review the changes in the diff view.",content:a}):{success:!1,message:"No fixes needed or could not generate a fix."}}catch(e){return{success:!1,message:`Error in ErrorFixAgent: ${e instanceof Error?e.message:String(e)}`}}}extractCode(e){const t=Array.from(e.matchAll(/```(?:[\w-]*\n)?([\s\S]*?)```/g));return t.length>0?t.reduce(((e,t)=>t[1].length>e.length?t[1]:e),"").trim():e.trim()}async validate(e){return Boolean(e.filePath&&e.originalContent)}}t.ErrorFixAgent=c},872:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.SidebarProvider=void 0;const a=o(n(398)),c=n(477),l=n(326),d=n(40),u=n(130),f=n(196);t.SidebarProvider=class{constructor(e,t,n,r){this._mode="chat",this._chatHistory=[],this._context=e,this._geminiService=t,this._fileService=n,this._diffService=r,this.agentRegistry=c.AgentRegistry.getInstance(this._context),this.agentRegistry.registerAgent(new l.EditAgent),this.agentRegistry.registerAgent(new d.DocumentationAgent),this.agentRegistry.registerAgent(new u.TestAgent),this._devToolsAgent=new f.DevToolsAgent(this._context)}resolveWebviewView(e,t,n){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[a.Uri.joinPath(this._context.extensionUri,"webview-ui"),a.Uri.joinPath(this._context.extensionUri,"assets")]},e.webview.html=this._getHtmlForWebview(e.webview),e.webview.onDidReceiveMessage((async e=>{switch(e.type){case"sendMessage":await this._handleUserMessage(e.message);break;case"setMode":this.setMode(e.mode);break;case"clearChat":this._chatHistory=[],this._updateChatHistory()}}))}setMode(e){if(this._mode=e,this._chatHistory=[],this._updateChatHistory(),this._view){this._view.webview.postMessage({type:"setMode",mode:e});const t=this.getModeWelcomeMessage(e);this._chatHistory.push({role:"assistant",content:t}),this._updateChatHistory()}}getModeWelcomeMessage(e){switch(e){case"chat":return"Ask me anything about your code! You can reference files using @filename syntax.";case"agent":return"I'm ready to help you with file operations! Use:\n- @file to read files\n- /filename to create new files\n- #filename to edit files";case"devtools":return"DevTools mode activated! Available commands:\n- @ui-analyze <selector> - Analyze UI elements\n- @ui-fix <selector> - Fix UI issues\n- @ui-test <component> - Generate UI tests";default:return"How can I help you today?"}}async _handleUserMessage(e){try{let t;if(this._chatHistory.push({role:"user",content:e}),this._updateChatHistory(),this._view&&this._view.webview.postMessage({type:"setLoading",isLoading:!0}),"chat"===this._mode)e=await this._processFileReferences(e),t=await this._geminiService.generateResponse(this._chatHistory);else{const n=this.agentRegistry.findAgentForInput(e);if(n){const r=e.substring(n.commandPrefix.length).trim(),[i,...s]=r.split(" "),o=s.join(" ");try{const e={filePath:i,prompt:o,originalContent:await this._fileService.readFile(i),fileService:this._fileService,geminiService:this._geminiService,diffService:this._diffService},r=await n.execute(e);t=r.message,r.success||a.window.showErrorMessage(r.message)}catch(e){t=`Error processing file ${i}: ${e instanceof Error?e.message:String(e)}`,a.window.showErrorMessage(t)}}else t="No agent found to handle this command. Available commands:\n"+this.agentRegistry.getAllAgents().map((e=>`${e.commandPrefix} - ${e.description}`)).join("\n")}this._chatHistory.push({role:"assistant",content:t}),this._updateChatHistory(),this._view&&this._view.webview.postMessage({type:"setLoading",isLoading:!1})}catch(e){console.error("Error handling message:",e);const t=`Error: ${e instanceof Error?e.message:String(e)}`;this._view&&(this._view.webview.postMessage({type:"setLoading",isLoading:!1}),this._view.webview.postMessage({type:"addMessage",message:{role:"assistant",content:t}}))}}async _processFileReferences(e){const t=/@([^\s]+)/g;let n,r=e;for(;null!==(n=t.exec(e));){const e=n[1];try{const t=await this._fileService.readFile(e);r=r.replace(n[0],`@${e}\n\`\`\`\n${t}\n\`\`\``)}catch(t){console.error(`Error reading file ${e}:`,t)}}return r}async _handleToolCalls(e,t){let n=t||"";for(const t of e){const e=t.name,r=t.args||{};try{let t;switch(e){case"readFile":t=await this._fileService.readFile(r.filePath),n+=`\n\nRead file ${r.filePath}:\n\`\`\`\n${t}\n\`\`\``;break;case"writeFile":await this._fileService.writeFile(r.filePath,r.content),n+=`\n\nCreated file ${r.filePath}`;break;case"editFile":this._diffService.showDiff(r.filePath,r.originalContent,r.newContent),n+=`\n\nProposed changes to ${r.filePath}. Please review the diff and apply or reject the changes.`;break;default:n+=`\n\nUnknown function call: ${e}`}}catch(t){console.error(`Error executing function ${e}:`,t),n+=`\n\nError executing ${e}: ${t instanceof Error?t.message:String(t)}`}}return n}_updateChatHistory(){this._view&&this._view.webview.postMessage({type:"updateChatHistory",history:this._chatHistory})}_getHtmlForWebview(e){const t=e.asWebviewUri(a.Uri.joinPath(this._context.extensionUri,"webview-ui","main.js")),n=e.asWebviewUri(a.Uri.joinPath(this._context.extensionUri,"webview-ui","styles.css")),r=function(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<32;n++)e+=t.charAt(Math.floor(62*Math.random()));return e}();return`<!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource} https://cdnjs.cloudflare.com; script-src 'nonce-${r}'; font-src https://cdnjs.cloudflare.com;">\n      <link href="${n}" rel="stylesheet">\n      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">\n      <title>Momo</title>\n      <style>\n        .logo {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        .logo i {\n          font-size: 24px;\n          color: var(--vscode-editor-foreground);\n        }\n      </style>\n    </head>\n    <body>\n      <header>\n        <div class="logo">\n          <i class="fa fa-comments-o" aria-hidden="true"></i>\n          <h1>Momo</h1>\n        </div>\n        <div class="mode-selector">\n          <button id="askMode" class="mode-button active">Ask</button>\n          <button id="agentMode" class="mode-button">Agent</button>\n          <button id="devtoolsMode" class="mode-button">DevTools</button>\n        </div>\n        <button id="clearChat" class="clear-button">Clear</button>\n      </header>\n      \n      <div id="chatContainer" class="chat-container">\n        <div id="chatMessages" class="chat-messages"></div>\n      </div>\n      \n      <div class="input-container">\n        <textarea id="userInput" placeholder="Type your message..." rows="3"></textarea>\n        <button id="sendButton" class="send-button">Send</button>\n      </div>\n      \n      <script nonce="${r}" src="${t}"><\/script>\n    </body>\n    </html>`}_trackLastEditedFile(e){this._context.workspaceState.update("lastEditedFile",e)}_extractCodeFromResponse(e){const t=/```(?:[\w-]*\n)?([\s\S]*?)```/g,n=[];let r;for(;null!==(r=t.exec(e));){const e=r[1].trim().replace(/\/\/ \.\.\. existing code \.\.\.\n?/g,"").replace(/\/\* \.\.\. existing code \.\.\. \*\/\n?/g,"");n.push(e)}return n.length>0?n.reduce(((e,t)=>t.length>e.length?t:e),""):e}_getLanguageValidationRules(e){return{".html":"For HTML files:\n1. Preserve DOCTYPE declaration if present\n2. Maintain proper tag nesting and closure\n3. Preserve meta tags and their attributes in head section\n4. Keep script and style tags intact unless explicitly modified\n5. Preserve class, id, and data attributes\n6. Maintain proper indentation of nested elements",".js":"For JavaScript files:\n1. Preserve import/export statements\n2. Maintain function and class declarations\n3. Keep variable declarations and their scope\n4. Preserve async/await and Promise chains\n5. Keep error handling (try/catch) blocks\n6. Maintain module exports\n7. Preserve event listeners and callbacks",".ts":"For TypeScript files:\n1. Preserve type declarations and interfaces\n2. Maintain import/export statements\n3. Keep type annotations and generics\n4. Preserve class decorators and metadata\n5. Maintain namespace declarations\n6. Keep enum declarations\n7. Preserve access modifiers (public, private, etc.)",".jsx":"For JSX/React files:\n1. Preserve component imports and exports\n2. Maintain prop types and default props\n3. Keep state declarations and hooks\n4. Preserve component lifecycle methods\n5. Maintain event handlers\n6. Keep JSX structure and nesting\n7. Preserve key props and refs",".tsx":"For TSX/React files:\n1. Preserve type declarations and interfaces\n2. Maintain component props typing\n3. Keep hooks and their type definitions\n4. Preserve component exports and imports\n5. Maintain generic type parameters\n6. Keep event handler typings\n7. Preserve context types and providers",".css":"For CSS files:\n1. Preserve selector specificity\n2. Maintain media queries\n3. Keep vendor prefixes\n4. Preserve keyframe animations\n5. Maintain variable declarations\n6. Keep import statements\n7. Preserve comment-based section markers",".py":"For Python files:\n1. Preserve import statements\n2. Maintain function and class definitions\n3. Keep docstrings and type hints\n4. Preserve decorators\n5. Maintain indentation levels\n6. Keep context managers (with statements)\n7. Preserve global variables and constants",".java":"For Java files:\n1. Preserve package declaration\n2. Maintain import statements\n3. Keep class and interface declarations\n4. Preserve annotations\n5. Maintain access modifiers\n6. Keep exception handling\n7. Preserve generic type parameters",".php":"For PHP files:\n1. Preserve namespace declarations\n2. Maintain use statements\n3. Keep class and trait declarations\n4. Preserve PHP tags\n5. Maintain error handling\n6. Keep method visibility\n7. Preserve type declarations",".go":"For Go files:\n1. Preserve package declaration\n2. Maintain import statements\n3. Keep interface and struct definitions\n4. Preserve error handling\n5. Maintain goroutine calls\n6. Keep defer statements\n7. Preserve type declarations",".rs":"For Rust files:\n1. Preserve use statements\n2. Maintain mod declarations\n3. Keep trait implementations\n4. Preserve macro invocations\n5. Maintain type definitions\n6. Keep lifetime annotations\n7. Preserve error handling"}[e]||"Generic rules:\n1. Preserve all import/include statements\n2. Maintain function and class declarations\n3. Keep variable declarations and scope\n4. Preserve language-specific keywords and operators\n5. Maintain proper indentation and formatting\n6. Keep comments and documentation\n7. Preserve error handling structures"}}},883:(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.diffSentences=function(e,t,n){return i.diff(e,t,n)},t.sentenceDiff=void 0;var i=new(((r=n(255))&&r.__esModule?r:{default:r}).default);t.sentenceDiff=i,i.tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)}},928:e=>{e.exports=require("path")},943:e=>{e.exports=require("fs/promises")},960:function(e,t,n){var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),o=0;o<n.length;o++)"default"!==n[o]&&i(t,e,n[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.FileService=void 0;const a=o(n(398)),c=o(n(943)),l=o(n(928));t.FileService=class{constructor(e){this.context=e}async readFile(e){try{const t=this.resolveFilePath(e),n=a.Uri.file(t);return await c.readFile(n.fsPath,"utf-8")}catch(t){throw new Error(`Could not read file ${e}: ${t instanceof Error?t.message:String(t)}`)}}async writeFile(e,t){try{const n=l.join(a.workspace.workspaceFolders?.[0].uri.fsPath||"",e);await a.workspace.fs.createDirectory(a.Uri.file(l.dirname(n))),await c.writeFile(n,t,"utf-8")}catch(t){throw console.error("Error writing file:",t),new Error(`Failed to write file ${e}: ${t instanceof Error?t.message:String(t)}`)}}async editFile(e,t){try{e.startsWith("#")&&(e=e.substring(1));const n=a.Uri.file(this.resolveFilePath(e)),r=(await a.workspace.openTextDocument(n),new a.WorkspaceEdit);for(const e of t)r.replace(n,e.range,e.text);return await a.workspace.applyEdit(r)}catch(t){throw console.error(`Error editing file ${e}:`,t),new Error(`Failed to edit file ${e}: ${t}`)}}async getResourceInfo(e){try{e.startsWith("@")&&(e=e.substring(1));const t=a.Uri.file(this.resolveFilePath(e)),n=await a.workspace.fs.stat(t);if(n.type===a.FileType.Directory){const n=await a.workspace.fs.readDirectory(t);return{type:"directory",name:l.basename(e),path:e,contents:n.map((([e,t])=>({name:e,type:t===a.FileType.Directory?"directory":"file"})))}}return{type:"file",name:l.basename(e),path:e,size:n.size}}catch(t){throw console.error(`Error getting resource info for ${e}:`,t),new Error(`Failed to get resource info for ${e}: ${t}`)}}resolveFilePath(e){if(l.isAbsolute(e))return e;const t=a.workspace.workspaceFolders;if(!t)throw new Error("No workspace folder found");return l.join(t[0].uri.fsPath,e)}async fileExists(e){try{const t=a.Uri.file(this.resolveFilePath(e));return await a.workspace.fs.stat(t),!0}catch{return!1}}async listDirectory(e){try{const t=a.Uri.file(this.resolveFilePath(e));return await a.workspace.fs.readDirectory(t)}catch(t){throw new Error(`Could not list directory ${e}: ${t instanceof Error?t.message:String(t)}`)}}async createDirectory(e){try{const t=a.Uri.file(this.resolveFilePath(e));await a.workspace.fs.createDirectory(t)}catch(t){throw new Error(`Could not create directory ${e}: ${t instanceof Error?t.message:String(t)}`)}}async delete(e,t){try{const n=a.Uri.file(this.resolveFilePath(e));await a.workspace.fs.delete(n,t)}catch(t){throw new Error(`Could not delete ${e}: ${t instanceof Error?t.message:String(t)}`)}}async createFile(e,t=""){try{await c.writeFile(e,t,"utf-8")}catch(t){throw new Error(`Could not create file ${e}: ${t instanceof Error?t.message:String(t)}`)}}async createFolder(e){try{await c.mkdir(e,{recursive:!0})}catch(t){throw new Error(`Could not create folder ${e}: ${t instanceof Error?t.message:String(t)}`)}}}}},t={},n=function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}(265);module.exports=n})();